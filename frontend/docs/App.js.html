<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: App.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: App.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
import { useCallback, useEffect, useMemo, useReducer, useState } from 'react';
import './App.css';
import Header from './components/Header/Header';
import Menu from './components/Menu/Menu';
import Keys  from './components/Content/KeysFolder/Keys';
import Users  from './components/Content/Users/Users';
import Layout from './components/Layout/Layout';
import axios from './axios';
import Loading from './components/UI/Loading/Loading';
import Searching from './components/UI/Searching/Searching';
import Footer from './components/Footer/Footer';
import JakisKontekst from './context/theme';
import ContentContext from  './context/contentContext';
import Content from './components/Content/Content';
import ActiveKeys from './components/Content/ActiveKeys/ActiveKeys';
import NewActive from './components/Content/ActiveKeys/NewActive/NewActive';
import ActiveKey from './components/Content/ActiveKeys/ActiveKey/ActiveKey';
import DataHeader from './components/DataHeader/DataHeader';
import SwitchSearch from './components/UI/Searching/switch/switchSearch';
import ErrorBoundary from './HOC/ErrorBoundary';

/**
 * Funkcja wybiera, który ze stanów ma zostać zmieniony.
 * @param {*} state Stan, który jest modyfikowany
 * @param {*} action Przypadek w zależności od którego zostanie wykonana modyfikacja stanu
 * @returns Wybrany stan zostanie zaktualizowany
 */
const reducer = (state,action) => {
  switch (action.type) {
    case 'set-backKeys':
      return { ...state, backKeys: action.backKeys};
    case 'set-showKeys':
      return { ...state, showKeys: action.showKeys};
    case 'set-keys':
      return { ...state, keys: action.keys};
    case 'set-users':
      return { ...state, users: action.users};
    case 'set-active':
      return { ...state, active: action.active};
    case 'set-archives':
      return { ...state, archives: action.archives};
    case 'set-loading':
      return { ...state, loading: action.loading};
    case 'change-content':
      return { ...state, content: action.content};
    case 'change-lastContent':
      return { ...state, lastContent: action.lastContent};
    default:
      throw new Error (' nie ma takiej funkcji '+ action.type)
  }
}

const initialState = {
  showKeys: [],
  backKeys: [],
  keys: [],
  users: [],
  active: [],
  archives: [],
  loading: true,
  lastContent:'',
  content: 'calendar',
  //theme: 'primary'
}

/**
 * Komponent obsługujący całą aplikację
 * @returns komponent Layout
 */
function App(){
  /**
   * 
   */
  const [state, dispatch] = useReducer(reducer, initialState);
  
/**
 * Funkcja pobiera dane z backendu i wywołuje hook useReduce który zapisze kolekcje w poszczególnych stanach 
 * @async
 * @function fetchBack
 */
  const fetchBack = async () => {
    const resKeys = await axios.get('/keys');
    const resUsers = await axios.get('/users');
    const resActive = await axios.get('/active');
    const resArchives = await axios.get('/archives')
    const keys = resKeys.data;
    const users = resUsers.data;
    const active = resActive.data;
    const archives = resArchives.data;

    dispatch({type: 'set-showKeys', showKeys:keys});
    dispatch({type: 'set-backKeys', backKeys:keys});
    dispatch({type: 'set-keys', keys:keys});
    dispatch({type: 'set-users', users:users});
    dispatch({type: 'set-active', active:active});
    dispatch({type: 'set-archives', archives:archives});
  }

/**
 * Funkcja filtruje dany stan w poszukiwaniu obiektu zawierający dany ciąg znaków
 * @function searchHandler
 * @param {String} name Ciąg znaków pobrany z wyszukiwarki
 */
  const searchHandler = name => {
    console.log('szukaj z app', name)
    const searchKeys = [...state.backKeys]
                    .filter(x => x.blok
                    .toLowerCase()
                    .includes(name.toLowerCase()));
    dispatch({type: 'set-keys', keys:searchKeys});
    // &lt;SwitchSearch
    //   content={state.content}
    // />
  }

/**
 * Podczas tworzenia się komponentu App zostanie wywołana funkcja fetchBack oraz zniknie ikonka ładowania
 * 
 */
  useEffect(()=>{
      fetchBack();
      dispatch({type: 'set-loading', loading:false});
    },[]);
  
  /**
   * Przekazuje do reducera, 
   * @function changeContent
   * @param {String} content Nazwa zawartości komponentu 
   */
  const changeContent = (content) => {
    dispatch({type: 'change-lastContent', lastContent:state.content})
    dispatch({type: 'change-content', content:content});  
  }


  // const available = useCallback( ()=> {
  //   var table = [...keys];
  //   for (var i=active.length; i>0; i--){
  //     const act =active[i-1].key_id;
  //     const ava = [...table].filter(keys=>(keys.numer+' '+keys.blok)!==act);
  //     table =ava;
  //     console.log(table.lenght)
  //   }
  //   return table;
  //   //setAvailable(table)
  // }, [active]);

  const header = &lt;Header>
    &lt;Searching  onSearch={name => searchHandler(name)}/>
  &lt;/Header>

  const menu = (
    &lt;Menu changeContent={content=>changeContent(content)}/>
  );

  const content = (
    state.loading ? 
    &lt;Loading />
    :&lt;ErrorBoundary>
      &lt;Content 
        content={state.content}
        lastContent={state.lastContent}
        keys={state.keys}
        active={state.active}
        archives={state.archives}
        users={state.users}
        showKeys={state.showKeys}
        backKeys={state.backKeys}
        // availableKeys={availableKeys}
        changeContent={changeContent}
        setBackKeys={keys=>dispatch({type: 'set-backKeys', backKeys:keys})}
        setKeys={keys=>dispatch({type: 'set-keys', keys:keys})}
        setUsers={users=>dispatch({type: 'set-users', users:users})}
        setActive={active=>dispatch({type: 'set-active', active:active})}
        setArchives={archives=>dispatch({type: 'set-archives', archives:archives})}
        setShowKeys={showKeys=>dispatch({type: 'set-showKeys', showKeys:showKeys})}
        // setAvailable={setAvailable}
        // available={available}
        />
    &lt;/ErrorBoundary>
    // }
    // &lt;/ContentContext.Provider>
  );
  
  const footer = &lt;Footer />

  return(
    &lt;JakisKontekst.Provider value="primary">
        &lt;Layout 
          header={header}
          menu={menu}
          content={content}
          footer={footer}
        /> 
    &lt;/JakisKontekst.Provider>
  );
}

export default App;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ErrorBoundary.html">ErrorBoundary</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addObject">addObject</a></li><li><a href="global.html#addUser">addUser</a></li><li><a href="global.html#App">App</a></li><li><a href="global.html#changeContent">changeContent</a></li><li><a href="global.html#changeHandler">changeHandler</a></li><li><a href="global.html#Clock">Clock</a></li><li><a href="global.html#colorChange">colorChange</a></li><li><a href="global.html#Content">Content</a></li><li><a href="global.html#DataHeader">DataHeader</a></li><li><a href="global.html#deleteUser">deleteUser</a></li><li><a href="global.html#editHandler">editHandler</a></li><li><a href="global.html#EditUser">EditUser</a></li><li><a href="global.html#editUser">editUser</a></li><li><a href="global.html#editUserHandler">editUserHandler</a></li><li><a href="global.html#fetchBack">fetchBack</a></li><li><a href="global.html#focusInput">focusInput</a></li><li><a href="global.html#Footer">Footer</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#Layout">Layout</a></li><li><a href="global.html#Loading">Loading</a></li><li><a href="global.html#makeTemp">makeTemp</a></li><li><a href="global.html#Menu">Menu</a></li><li><a href="global.html#monthBefore">monthBefore</a></li><li><a href="global.html#NewUser">NewUser</a></li><li><a href="global.html#onEdit">onEdit</a></li><li><a href="global.html#reducer">reducer</a></li><li><a href="global.html#RoomsCalendar">RoomsCalendar</a></li><li><a href="global.html#sameValue">sameValue</a></li><li><a href="global.html#Search">Search</a></li><li><a href="global.html#searchHandler">searchHandler</a></li><li><a href="global.html#Searching">Searching</a></li><li><a href="global.html#tableMaker">tableMaker</a></li><li><a href="global.html#toggleModal">toggleModal</a></li><li><a href="global.html#User">User</a></li><li><a href="global.html#Users">Users</a></li><li><a href="global.html#validateEmail">validateEmail</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Fri Sep 03 2021 15:52:50 GMT+0200 (czas środkowoeuropejski letni)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
