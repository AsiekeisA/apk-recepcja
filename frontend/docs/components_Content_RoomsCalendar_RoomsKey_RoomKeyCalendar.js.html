<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/Content/RoomsCalendar/RoomsKey/RoomKeyCalendar.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/Content/RoomsCalendar/RoomsKey/RoomKeyCalendar.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { useState, useEffect } from "react";

/**
 * 
 * @param props
 * @param props._id
 * @returns wiersz z kluczem i jego rezerwacjami
 */
export default function RoomKeyCalendar(props) {
    const inhabitant = [...props.active].filter(active=>active.key_id===props._id).filter(active=>active.live===true)[0]?false:true;
    const [emptyTable, setEmpty] = useState([]); 
    const active =[...props.active]
            .filter(active=>active.key_id===props._id)
            .filter(active=>active.live===false)
            .sort((a, b) => a.data > b.data ? 1 : -1)
    var index=0;
    var a_id=0;
    var table = [];
    const endMonth=props.lengthOfMonth+1
    //&amp;&amp;props.funkcja==="pokój" _______jeśli to działa to wrzucić do filtra
//sprawdzanie daty czy jest widoczna jeśli tak maluj od data do dataQuit....dla każdego active TO TABLICA !!! 
    const tableSet = () => {
        existActive(a_id);
        setEmpty(table);
    }

    const existActive = (i) =>{
        active[i]?takeDate(i):index&lt;=props.lengthOfMonth?emptyTo(endMonth):&lt;>&lt;/>;
    }

    //CallBack sprawdzić gdzie zadziałał zamiast useEffect
    useEffect(()=>{
        tableSet();
    },[props.active,props.month]);

    const howManyDays = (last) => {
        if(index===0){
            if(last===endMonth){
                return props.lengthOfMonth*2
            }else{
                return last*2-1
            } 
        }else if(last===endMonth){
            return (props.lengthOfMonth-index)*2+1
        }else{
            return (last-index)*2
        }
    }
    const emptyTo  = (last) => {
        if(index===0){
            index++
            if(last===endMonth){
                for(index; index&lt;=props.lengthOfMonth; index++){
                    table.push(&lt;td className={props.colorChange(index)}  
                    colSpan="2" id={index} key={"empty"+index}>&lt;/td>);
                }
            }else{
                for(index; index&lt;last; index++){
                    table.push(&lt;td className={props.colorChange(index)}  
                    colSpan="2" id={index} key={"empty"+index}>&lt;/td>);
                }
                table.push(&lt;td className={props.colorChange(index)}  
                    colSpan="1" id={index} key={"empty"+index}>&lt;/td>);
            } 
        }else if(last===endMonth){
            table.push(&lt;td className={props.colorChange(index)}  
            colSpan="1" id={index} key={"empty"+index}>&lt;/td>);
            index++
            for(index; index&lt;=props.lengthOfMonth; index++){
                table.push(&lt;td className={props.colorChange(index)}  
                colSpan="2" id={index} key={"empty"+index}>&lt;/td>);
            }
        }else{
            table.push(&lt;td className={props.colorChange(index)}  
            colSpan="1" id={index} key={"empty"+index}>&lt;/td>);
            index++
            for(index; index&lt;=last; index++){
                table.push(&lt;td className={props.colorChange(index)}  
                colSpan="2" id={index} key={"empty"+index}>&lt;/td>);
            }
            table.push(&lt;td className={props.colorChange(index)}  
            colSpan="1" id={index} key={"empty"+index}>&lt;/td>);
        }
    }
 
    const show = event => {
        const _id = event.target.value;
        const index = [...props.active].findIndex(active=>active._id===_id)
        const activeModel = {
            _id: props.active[index]._id, 
            key_id: props.active[index].key_id,
            user_id: props.active[index].user_id,
            data: props.active[index].data,
            dataQuit: props.active[index].dataQuit,
            live:props.active[index].live
        }
        props.onEdit(activeModel);
    }

    const reservation = (last) => {
        const color = Date.parse(new Date(active[a_id].data).toISOString().slice(0,10))!=Date.parse(active[a_id].data)
            ?'td-rent'
            :'td-reserved'
        const u_id=[...props.users].findIndex(x=>x._id===active[a_id].user_id)
        const userName=props.users[u_id].lastName+" "+props.users[u_id].firstName
        const days = howManyDays(last)
        table.push(&lt;td className={color}  
            colSpan={days} id={index} key={index}>
                &lt;button alt={userName} className="button-td" value={active[a_id]._id} onClick={show}>&lt;/button>
            &lt;/td>);
        index=last
        a_id++
        existActive(a_id)
    }
  
    const takeDate = (i) => {
        const dataStart = new Date(active[i].data)
        const dataEnd = new Date(active[i].dataQuit)
        const yearS = dataStart.getFullYear();
        const yearE = dataEnd.getFullYear();
        const monthS = dataStart.getMonth();
        const monthE = dataEnd.getMonth();
        const dayS = dataStart.getDate();
        const dayE = dataEnd.getDate();
        if(yearS===props.year){
            if (yearS===yearE) {
                if(monthS===props.month){
                    if(dayS>index){
                        emptyTo(dayS)
                    }
                    if(monthS===monthE){
                        reservation(dayE)
                    }else{
                        reservation(endMonth)
                    }
                }else if(monthE===props.month){
                    reservation(dayE)
                }else if(monthS&lt;props.month&amp;&amp;props.month&lt;monthE){
                    reservation(endMonth)
                }else{
                    a_id++
                    existActive(a_id);
                }
            } else if(monthS&lt;=props.month){
                if(monthS===props.month){
                    emptyTo(dayS)
                }
                reservation(endMonth)
            }else{
                a_id++
                existActive(a_id);
            }
        }else if(yearE===props.year){
            if(monthE===props.month){
                reservation(dayE)
            }else if(props.month&lt;monthE){
                reservation(endMonth)
            }else{
                a_id++
                existActive(a_id);
            }
        }else if(yearS&lt;props.year&amp;&amp;yearE>props.year){
            reservation(endMonth)
        }else{
            a_id++
            existActive(a_id);
        }    
    }  

    const keyModel = {
        _id:props._id, 
        numer:props.numer, 
        blok:props.blok, 
        funkcja:props.funkcja, 
        ile:props.ile,
        ileDost:props.ileDost,
        czyDost:props.czyDost
    };
    
    const newActiveHandler = () => {
        props.makeTemp(keyModel)
    }

    return(
        &lt;>
        {inhabitant?
            &lt;tr>
                &lt;td>{props.numer} {props.blok} ({props.ile})&lt;/td>
                {emptyTable}
            &lt;td className="tdBtn">&lt;button className="button" onClick={newActiveHandler}>Rezerwacja&lt;/button>&lt;/td>
            &lt;/tr>
        :&lt;>&lt;/>}
        &lt;/>
    );
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ErrorBoundary.html">ErrorBoundary</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addObject">addObject</a></li><li><a href="global.html#addUser">addUser</a></li><li><a href="global.html#App">App</a></li><li><a href="global.html#changeContent">changeContent</a></li><li><a href="global.html#changeHandler">changeHandler</a></li><li><a href="global.html#Clock">Clock</a></li><li><a href="global.html#colorChange">colorChange</a></li><li><a href="global.html#Content">Content</a></li><li><a href="global.html#DataHeader">DataHeader</a></li><li><a href="global.html#deleteUser">deleteUser</a></li><li><a href="global.html#editHandler">editHandler</a></li><li><a href="global.html#EditUser">EditUser</a></li><li><a href="global.html#editUser">editUser</a></li><li><a href="global.html#editUserHandler">editUserHandler</a></li><li><a href="global.html#fetchBack">fetchBack</a></li><li><a href="global.html#focusInput">focusInput</a></li><li><a href="global.html#Footer">Footer</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#Layout">Layout</a></li><li><a href="global.html#Loading">Loading</a></li><li><a href="global.html#makeTemp">makeTemp</a></li><li><a href="global.html#Menu">Menu</a></li><li><a href="global.html#monthBefore">monthBefore</a></li><li><a href="global.html#NewUser">NewUser</a></li><li><a href="global.html#onEdit">onEdit</a></li><li><a href="global.html#reducer">reducer</a></li><li><a href="global.html#RoomsCalendar">RoomsCalendar</a></li><li><a href="global.html#sameValue">sameValue</a></li><li><a href="global.html#Search">Search</a></li><li><a href="global.html#searchHandler">searchHandler</a></li><li><a href="global.html#Searching">Searching</a></li><li><a href="global.html#tableMaker">tableMaker</a></li><li><a href="global.html#toggleModal">toggleModal</a></li><li><a href="global.html#User">User</a></li><li><a href="global.html#Users">Users</a></li><li><a href="global.html#validateEmail">validateEmail</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Fri Sep 03 2021 15:52:50 GMT+0200 (czas środkowoeuropejski letni)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
